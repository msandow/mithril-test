<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Mithril Test</title>
  <!--
  <link rel="stylesheet" href="css/styles.css?v=1.0">
  -->
  <script src="mithril.min.js"></script>
  <script src="mithril.factory.js"></script>
  <script>
    window.onload = function(){
      
      var components = {
        link: function(href, text, conf){
          conf = conf || {}
          var ooc = conf.onclick || function(){}
          conf.onclick = function(evt){
            evt.preventDefault();
            m.route(href);
            ooc();
          };
          conf.href = "/" + href;
          
          return m.el("a", conf, text);
        }
      };

      var Navigation = m.boiler();
      Navigation.name = "Navigation";
      Navigation.model = function(){
        this.links = m.prop([
          {text: 'Home', link: '/home'},
          {text: 'About', link: '/about'}
        ]);
      };
      Navigation.controller = function(){
        
      };
      Navigation.view = function(ctrl){
        return ctrl.model.links().map(function(l){
          var li = components.link(l.link, l.text);

          if(m.route() === l.link){
            li.attrs.style = 'font-weight:bold';
          }
          
          return li;
        });
      };      
      
      m.addModule(Navigation);
      
      var Empty = m.boiler();
      Empty.name = "Empty";
      Empty.path = "/";
      Empty.model = function(){
        
      };
      Empty.controller = function(){
        
      };
      Empty.view = function(ctrl){
        return null
      };      
      
      m.addModule(Empty);
      
      var simple = function(name, route){
        m.addModule(m.boiler({
          name: name,
          path: route,
          model: function(){
            this.text = m.prop('');
          },
          controller: function(){
            var self = this;
            setTimeout(function(){              
              self.model.text(name);
              m.redraw();
            },500);
          },
          view: function(ctrl){
            return [
              m.el('h4',ctrl.model.text()),
              m.el('a[href="#"]', {
                onclick: function(evt){
                  evt.preventDefault();
                  console.log(m.getModule('Navigation').currentModel.links().push({text: 'Home', link: '/home'}))
                }
              }, 'push')
            ];
          }
        }));
      };

      simple('Home', '/home');
      simple('About', '/about');

      m.renderModule(document.querySelector('#nav'), 'Navigation');
      m.buildRoutes(document.querySelector('#body'));

    };
  </script>
</head>

<body>
  <nav id="nav"></nav>
  <section id="body"></section>
  
</body>
</html>