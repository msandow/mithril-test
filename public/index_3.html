<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Mithril Test</title>
  <!--
  <link rel="stylesheet" href="css/styles.css?v=1.0">
  -->
  <script src="mithril.min.js"></script>
  <script src="mithril.factory.js"></script>
  <script>
    window.onload = function(){
      
      var components = {
        user: function(name){
          return {
            name: name,
            counter: 0,
            increment: function(){
              this.counter++;
            },
            setName: function(evt){
              this.name = evt.target.value
            }
          };
        }
      };
      
      var Index = m.create({
        path: "/",
        name: "Home",
        model: function(){
          this.users = [];
        },
        events: {
          "mouseenter p": function(){
            this.style.textDecoration = "underline";
          },
          "mouseleave p": function(){
            this.style.textDecoration = "none";
          }
        },
        controller: function(){
          Index.model.users.push(
            components.user('Bob'),
            components.user('Joe'),
            components.user('Betty'),
            components.user('Zane')
          );
        },
        view: function(ctrl){
          var children = Index.model.users.map(function(user){
            return m.el("p", [
              m.el('input',{
                type: 'text',
                value: user.name,
                onkeyup: function(evt){
                  user.setName(evt)
                }
              }),
              ' - ' + user.counter + ' ',
              m.el('a',{
                onclick: function(evt){
                  evt.preventDefault();
                  user.increment();
                },
                href: '#'
              }, 'Add')
            ]);
          });
          
          children.push(m.el("p", [
            m.el("a",{
              onclick: function(evt){
                evt.preventDefault();                
                Index.bookmark();
                Index.model.users.push(components.user('Foo'))
              },
              href: '#'
            },'Bookmark'),
            '   ',
            m.el("a",{
              onclick: function(evt){
                evt.preventDefault();
                Index.reset();
              },
              href: '#'
            },'Reset')
          ]));
          
          return children;
        }
      });
      
      m.register(Index);
      m.buildRoutes(document.querySelector('#body'));

    };
  </script>
</head>

<body>
  <section id="body"></section>
  
</body>
</html>